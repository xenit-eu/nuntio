version: '3.4'
services:
  consul:
    image: docker.io/library/consul:latest
    command:
      - agent
      - '-dev'
      - '-client=0.0.0.0'
    ports:
      - ${DOCKER_IP}::8500
  dind:
    image: docker.io/library/docker:dind
    privileged: true
    ports:
      - ${DOCKER_IP}::2375
    command:
      - dockerd
      - --tls=false
      - --host=tcp://0.0.0.0:2375
      - --host=unix:///var/run/docker.sock
    environment:
      DOCKER_TLS_CERTDIR: '' # Disable docker TLS
    healthcheck:
      test:
        - CMD
        - docker
        - info
