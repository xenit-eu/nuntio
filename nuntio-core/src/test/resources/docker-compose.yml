version: '3.4'
services:
  nuntio:
    image: ${DOCKER_IMAGE}
    environment:
      JAVA_OPTS_CONSUL: -Dnuntio.consul.host=consul
    volumes:
      - type: bind
        source: /var/run/docker.sock
        target: /var/run/docker.sock

  consul:
    image: hub.xenit.eu/public/consul:1.4.4
    command:
      - agent
      - '-dev'
      - '-client=0.0.0.0'
    labels:
      nuntio.vbgn.be/service: consul-test
      nuntio.vbgn.be/tags: server,leader
      nuntio.vbgn.be/metadata/internal-address: consul-test.vbgn.be
    ports:
      - ${DOCKER_IP}::8500
